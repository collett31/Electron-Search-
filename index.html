<!DOCTYPE html>
<html>
  <head>
        <title>Search Em</title>
        <meta name="viewport" content="width=device-width, initial-scale=1" charset="UTF-8">
        <style>
           h3.hTag {display: inline;}
           fieldset>span { display: block; }
           fieldset[data-show-advanced='false'] { display: none; }
           fieldset[data-show-advanced='true'] { display: block; }
        </style>      
  </head>
  <body>
        <h2>Search Em</h2>
  
        <form  class="search-form">
          <h3 class="hTag">Search by: </h3>  
          <select required class='search-type'>
              <option value="Authors" selected>Author's Name</option>
              <option value="Title">Title</option>
              <option value="Keyword">Keyword</option>
          </select>
          
          <input type="text" name="search-term" id = "result" placeholder="Search here" required><br><br>

          <fieldset data-show-advanced='false'>
            <span >
              <select required>
                  <option value="Author" selected>Author's Name</option>
                  <option value="Title">Title</option>
                  <option value="keyword">Keyword</option>
              </select>
              <input type="text" name='advanced-1'>
              <select required>
                  <option value="or">OR</option>
                  <option value="and">AND</option>
              </select>
              <span>
                <label for="advanced-1-not">NOT</label>
                <input type="checkbox" name="advanced-1-not" id="advanced-1-not">
              </span>
            </span>
            <span >
                <select required>
                    <option value="Author" selected>Author's Name</option>
                    <option value="Title">Title</option>
                    <option value="keyword">Keyword</option>
                </select>
                <input type="text" name='advanced-1'>
                <select required>
                    <option value="or">OR</option>
                    <option value="and">AND</option>
                </select>
                <span>
                  <label for="advanced-1-not">NOT</label>
                  <input type="checkbox" name="advanced-1-not" id="advanced-1-not">
                </span>
              </span>
              <span >
                  <select required>
                      <option value="Author" selected>Author's Name</option>
                      <option value="Title">Title</option>
                      <option value="keyword">Keyword</option>
                  </select>
                  <input type="text" name='advanced-1'>
                  <select required>
                      <option value="or">OR</option>
                      <option value="and">AND</option>
                  </select>
                  <span>
                    <label for="advanced-1-not">NOT</label>
                    <input type="checkbox" name="advanced-1-not" id="advanced-1-not">
                  </span>
                </span>
                <span >
                    <select required>
                        <option value="Author" selected>Author's Name</option>
                        <option value="Title">Title</option>
                        <option value="keyword">Keyword</option>
                    </select>
                    <input type="text" name='advanced-1'>
                    <select required>
                        <option value="or">OR</option>
                        <option value="and">AND</option>
                    </select>
                    <span>
                      <label for="advanced-1-not">NOT</label>
                      <input type="checkbox" name="advanced-1-not" id="advanced-1-not">
                    </span>
                  </span>
                  <span >
                      <select required>
                          <option value="Author" selected>Author's Name</option>
                          <option value="Title">Title</option>
                          <option value="keyword">Keyword</option>
                      </select>
                      <input type="text" name='advanced-1'>
                      <select required>
                          <option value="or">OR</option>
                          <option value="and">AND</option>
                      </select>
                      <span>
                        <label for="advanced-1-not">NOT</label>
                        <input type="checkbox" name="advanced-1-not" id="advanced-1-not">
                      </span>
                    </span>
          </fieldset>

          <input type="submit" value="Search" >
          <span>
            <label for="advanced">Advanced Search</label>
            <input type="checkbox" name="advanced-search" id="advanced">
          </span>
        </form>
        <input type="file" name="file" id="file">

    <script>
      document.querySelector('.search-form').addEventListener('submit', function(e) {
        e.preventDefault();

        // check if advanced search enabled
        const isAdvancedEnabled = document.getElementById('advanced').checked;

        if (isAdvancedEnabled) {

        } else {
          // get search term
          const searchTerm = document.getElementById("result").value
          
          // get search type
          const searchType = document.querySelector('.search-type').value;

          switch (searchType) {
            case 'Authors':
              break;
            
            case 'Title':
              break;

            case 'Keyword':
              break;
          }
        }
        
          var results = []; 
          //console.log(txt);

          if( keySearch == "Authors"){
           
            for (var i = 0 ; i < obj.list.length ; i++)
            {
                if (object.json[i][keySearch] == valueSearch) {
                    results.push(obj.list[i]);
                }
            }
            console.log(results);
          } else if ( keySearch == 'Title'){
            
          }
          else{
            
          }  
      });

        document.querySelector('#advanced').onchange = function(e) 
        {
          const fieldset = document.querySelector('form > fieldset');
          const advancedShowing = this.checked;

          fieldset.setAttribute(
            'data-show-advanced', 
            advancedShowing
          )

          document.querySelector('.search-type').disabled = advancedShowing;
          document.querySelector('input[name="search-term"').disabled = advancedShowing;
        }
    </script>

    <script>
        document.getElementById('file').onchange = function(){
          var fs = require("fs");
          let data = {};
            var file = this.files[0];
            var reader = new FileReader();

            reader.onload = function(progressEvent){
              // By lines
              const separator = /\s+-+\s+\w+\s+[0-9][0-9]\s+\w+\s+[0-9][0-9]\s+-+/;
              let currentCitation = 0;
              var lines = this.result.split('\r\n');
              for(var line = 0; line < lines.length; line++)
              {
                let currentLine = lines[line];

                if (currentLine.match(separator)) {
                  currentCitation++;
                  continue;
                }

                var n = currentLine.indexOf(":");
                if (n > 0)
                {
                  let keyAndValue = currentLine.split(':');
                  let [ key, value ] = keyAndValue;

                  if (data[`citation-${currentCitation}`]) {
                    data[`citation-${currentCitation}`][key] = value.trim();
                  } else {
                    data[`citation-${currentCitation}`] = {};
                    data[`citation-${currentCitation}`][key] = value.trim();
                  }
                } else {
                  if (data[`citation-${currentCitation}`]) {
                    data[`citation-${currentCitation}`][currentLine] = true;
                  } else {
                    data[`citation-${currentCitation}`] = {};
                    data[`citation-${currentCitation}`][currentLine] = true;
                  }
                }              
              }

              fs.writeFile('./object.json', JSON.stringify(data, null, 2), (err) => {
                if (err) {
                  console.error(err);
                    return;
                };
                console.log("File has been created");
              });
            };
            reader.readAsText(file);
          };
    </script>
  </body>
</html>